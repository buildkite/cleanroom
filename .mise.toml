[tools]
go = "1.23"

[env]
GOTOOLCHAIN = "local"

[tasks.test]
description = "Run cross-platform Go test suite"
run = "go test ./..."

[tasks.test-full]
description = "Run full Go test suite"
run = "go test ./..."

[tasks.build]
description = "Build binaries into dist/"
run = "mkdir -p dist && go build -o dist/cleanroom ./cmd/cleanroom && go build -o dist/cleanroom-guest-agent ./cmd/cleanroom-guest-agent"

[tasks.install]
description = "Install binaries into GOBIN (or GOPATH/bin)"
run = "go install ./cmd/cleanroom ./cmd/cleanroom-guest-agent"

[tasks.prepare-firecracker-image]
description = "Prepare rootfs image with guest agent and tiny init (requires sudo)"
depends = ["build", "install"]
run = "sudo scripts/prepare-firecracker-image.sh"

[tasks.doctor]
description = "Run cleanroom diagnostics"
run = "go run ./cmd/cleanroom doctor"

[tasks.doctor-json]
description = "Run cleanroom diagnostics as JSON"
run = "go run ./cmd/cleanroom doctor --json"
